<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <link rel="stylesheet" href="../static/layui/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="../static/layui/style/admin.css" media="all">

    <script type="text/javascript" src="../static/jquery/jquery.min.js"></script>
    <script src="../static/layui/layui/layui.js"></script>
    <script src="../static/action/action.js"></script>
</head>
<body>
<div style="height: 40px; margin: 10px 0px; background: white; line-height: 40px;">
    <div class="layui-btn-group" style="float: right; margin-right: 10px;">
<!--        <button id="add" type="button" class="layui-btn layui-btn-sm layui-btn-normal">-->
<!--            <i class="layui-icon">&#xe654;</i>-->
<!--        </button>-->
<!--        <button id="edit" type="button" class="layui-btn layui-btn-sm layui-btn-warm">-->
<!--            <i class="layui-icon">&#xe642;</i>-->
<!--        </button>-->
        <button id="remove" type="button" class="layui-btn layui-btn-sm layui-btn-danger">
            <i class="layui-icon">&#xe640;</i>
        </button>
    </div>
</div>
<table id="table" lay-filter="table"></table>
</body>
<script>
    var table;//数据表格对象
    var pageIndex;

    layui.config({
        base: '../static/layui/' //静态资源所在路径
    }).extend({
        index: '../layui/lib/index' //主入口模块
    }).use(['index', 'table'], function () {
        table = layui.table;

        table.render({ //初始化数据表格
            elem: '#table',
            url: '../user/list',
            where: {
                user_position: 0
            },
            method: 'get',
            parseData: function(res){
                return {
                    'code': res.code,
                    'msg': res.msg,
                    'count': res.data.total,
                    'data': res.data.list
                };
            },
            height: $(window).height() - 80,
            page: true, //开启分页
            limit: 30,
            limits: [30, 60, 90],
            cols: [[
                {
                    type: 'checkbox'
                },
                {
                    field: 'user_id',
                    title: '用户ID',
                    width: '20%'
                }, {
                    field: 'user_account',
                    title: '用户账户',
                    width: '20%'
                }, {
                    field: 'user_name',
                    title: '用户姓名',
                    width: '20%'
                }, {
                    field: 'user_age',
                    title: '用户年龄',
                    width: '20%'
                }, {
                    field: 'user_sex',
                    title: '用户性别',
                }
                ]
            ]
        });

        $('#edit').on('click', function () {
            var checkStatus = table.checkStatus('table');
            if(checkStatus.data.length != 1){
                layer.msg('请选择一行数据进行编辑！', {icon: 2});
            }else if(checkStatus.data[0].schedule != 0){
                layer.msg('已被预约，无法修改！', {icon: 2});
            }else {
                pageIndex = layer.open({
                    title: '编辑',
                    type: 2,
                    area: ['600px', '500px'],
                    content: 'time_edit.html'
                });
            }
        })

        $('#remove').on('click', function(){
            var checkStatus = table.checkStatus('table');
            if(checkStatus.data.length == 0){
                layer.msg('请选择需删除的数据！', {icon: 6});
            }else{
                var tids = new Array;
                checkStatus.data.map(function(item, index){
                    tids.push(item.tid);
                });
                $.action('../time/remove', JSON.stringify(tids), function (res) {
                    if(res.code == 0){
                        layer.msg('删除成功！', {icon: 1}, function () {
                            table.reload('table');
                        });
                    }else{
                        layer.msg(res.msg, {icon: 2});
                    }
                })
            }
        });
    });
</script>
</html>